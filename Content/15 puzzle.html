<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>15 puzzle</title>
	</head>
	<style>
		body {
			height: 100vh;
			margin: 0px;
			background: rgb(40, 44, 52);
			color: rgb(171, 178, 191);
			display: flex;
			align-items: center;
			justify-content: center;
			flex-direction: column;
		}
		#control {
			padding: 5px 0px 5px 30px;
			margin: 10px;
			font-size: 20px;
			background-color: rgb(45, 49, 57);
			width: 120px;
			border-radius: 10px;
		}
		#container {
			transition: 0.3s;
			height: 480px;
			width: 480px;
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			grid-template-rows: repeat(4, 1fr);
			gap: 0;
			border: 4px ridge wheat;
			position: relative;
		}
		.tile {
			position: absolute;
			box-sizing: border-box;
			user-select: none;
			height: 120px;
			width: 120px;
			border: 2px solid;
			border-color: black;
			font-size: 50px;
			font-weight: 600;
			color: rgb(40, 44, 52);
			display: none;
			align-items: center;
			justify-content: center;
			transition: 0.4s;
		}
		#start {
			all: unset;
			text-align: center;
			color: black;
			background-color: skyblue;
			margin: 20px;
			height: 30px;
			width: 80px;
			box-shadow: rgba(50, 50, 50, 0.5) 0px 0px 10px;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.2s;
		}
		#start:hover {
			color: white;
			transform: scale(1.1);
			background-color: deepskyblue;
		}
		#start:active {
			color: red;
			transform: scale(0.9);
			background-color: blue;
		}
		a {
			position: absolute;
			bottom: 2%;
		}
	</style>
	<body>
		<!--Â§ñÈÉ®ÈìæÊé•ÁöÑÊïôÁ®ã,Ëá™ÂÆö‰πâÈò∂Êï∞,ÂéÜÂè≤ËÆ∞ÂΩï-->
		<div id="control">
			<div id="time">TIME: 0s</div>
			<div id="step">STEP: 0</div>
		</div>
		<div id="container"></div>
		<button id="start">Ready?</button>
		<a href="https://en.wikipedia.org/wiki/15_puzzle" target="_blank">15 puzzle</a>
		<audio src="../Static/Sound/„ÄêÂ±±Êµ∑Âê¨Â£∞„Äë‰∫∫Â£∞Áæ§ÊùÇ-39-Áé∞‰ª£ ÁßØÊûÅÁöÑÂêÑÁßçÂ§∏ËµûÔºåËØÑËÆ∫ÂºπÂπï_Áà±ÁªôÁΩë_aigei_com.mp3"></audio>
		<script>
			const container = document.querySelector("#container"),
				start = document.querySelector("#start"),
				dom_time = document.querySelector("#time"),
				dom_step = document.querySelector("#step"),
				audio = document.querySelector("audio");

			let tiles = [],
				num = [],
				lastNum = [],
				is_start = false,
				is_move = false,
				time = 0,
				step = 0;

			setInterval(() => {
				if (is_move) time++;
				dom_time.textContent = `TIME: ${time}s`;
			}, 1000);
			for (let i = 0; i < 15; i++) {
				const div = document.createElement("div");
				div.className = "tile";
				div.textContent = i + 1;
				if (i % 2 === 0) div.style.backgroundColor = "red";
				else div.style.backgroundColor = "white";
				container.appendChild(div);
				tiles.push(div);
			}

			function shuffle(arr) {
				for (let i = arr.length - 1; i > 0; i--) {
					const j = Math.floor(Math.random() * (i + 1));
					[arr[i], arr[j]] = [arr[j], arr[i]];
				}
				return arr;
			}

			function solvable(arr) {
				let invCount = 0;
				for (let i = 0; i < 15; i++) {
					for (let j = i + 1; j < 16; j++) {
						if (arr[i] && arr[j] && arr[i] > arr[j]) invCount++;
					}
				}
				const zero = Math.ceil((arr.indexOf(0) + 1) / 4);
				return (invCount + zero) % 2 === 0;
			}

			function generate() {
				const now = new Date().getTime();
				step = 0;
				num.length = 0;
				dom_time.textContent = "TIME: 0s";
				dom_step.textContent = "STEP: 0";
				for (let i = 1; i <= 15; i++) num.push(i);
				num.push(0);
				do {
					shuffle(num);
				} while (!solvable(num));
				render();
			}

			function move(index) {
				const empty = num.indexOf(0),
					row = Math.floor(index / 4),
					col = index % 4,
					erow = Math.floor(empty / 4),
					ecol = empty % 4;
				if (Math.abs(row - erow) + Math.abs(col - ecol) !== 1) return;
				[num[index], num[empty]] = [num[empty], num[index]];
				render();
				console.log(num);
				dom_step.textContent = `STEP: ${++step}`;
				is_move = true;
				if (num.join() === "1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0") {
					setTimeout(() => {
						alert(`Excellent!\nIt took you ${time} sec and ${step} steps.`);
						generate();
						start.textContent = "GOODüòãüëç";
						audio.currentTime = 0;
						audio.play();
					}, 300);
				}
			}

			function render() {
				for (let i = 0; i < 16; i++) {
					if (num[i] === lastNum[i]) continue;
					const empty = num.indexOf(0),
						row = Math.floor(i / 4),
						col = i % 4,
						erow = Math.floor(empty / 4),
						ecol = empty % 4,
						val = num[i],
						tile = tiles[val - 1];
					if (val === 0) continue;
					if (val === i + 1) {
						tile.style.borderColor = "green";
						tile.style.color = "darkgreen";
					} else {
						tile.style.borderColor = "black";
						tile.style.color = "rgb(40,44,52)";
					}
					if (row === erow && Math.abs(col - ecol) === 1) {
						tile.style.cursor = "ew-resize";
					} else if (col === ecol && Math.abs(row - erow) === 1) {
						tile.style.cursor = "ns-resize";
					} else {
						tile.style.cursor = "not-allowed";
					}
					tile.style.transform = `translate3d(${col * 120}px, ${row * 120}px, 0)`;
				}
				lastNum = [...num];
			}
			tiles.forEach((tile, i) => {
				tile.addEventListener("click", () => {
					const index = num.indexOf(i + 1);
					move(index);
				});
				tile.addEventListener("touchstart", () => {
					const index = num.indexOf(i + 1);
					move(index);
				});
			});
			start.addEventListener("mouseenter", () => {
				if (!is_start) start.textContent = "Start!";
			});
			start.addEventListener("mouseleave", () => {
				if (!is_start) start.textContent = "Ready?";
			});
			start.addEventListener("click", () => {
				start.textContent = "Restart";
				is_start = true;
				tiles.forEach(tile => {
					tile.style.display = "flex";
				});
				generate();
			});
		</script>
	</body>
</html>
